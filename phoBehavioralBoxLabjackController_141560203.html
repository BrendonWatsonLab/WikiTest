<!DOCTYPE html>
<html>
    <head>
        <title>Watson Lab Behavioral Box : phoBehavioralBoxLabjackController</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Watson Lab Behavioral Box</a></span>
                            </li>
                                                    <li>
                                <span><a href="Watson-Lab---Behavioral-Box-Home_141559292.html">Watson Lab - Behavioral Box Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Behavioral-Box-Project_141559650.html">Behavioral Box Project</a></span>
                            </li>
                                                    <li>
                                <span><a href="Software-Ecosystem_141561507.html">Software Ecosystem</a></span>
                            </li>
                                                    <li>
                                <span><a href="Client-Software_147658139.html">Client Software</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Watson Lab Behavioral Box : phoBehavioralBoxLabjackController
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Pho Hale</span>, last modified on Aug 22, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p>The custom software written in C++ that collects beambreak and dispense events data and controls the visible LEDs via the Labjack Hardware.</p><p>Labjacks are named &quot;LJ-{LabjackID}&quot;</p><p><br/></p><p>Produces output in the form of two .csv files named:</p><p style="margin-left: 30.0px;"><code>out_file_s{recordingLabjackSerialNumber}_{unix_Epoch_Timestamp}.csv</code> // (for discrete values)</p><p style="margin-left: 30.0px;"><code>out_file_analog_s{recordingLabjackSerialNumber}_{unix_Epoch_Timestamp}.csv</code>  // (for analog values, like running wheel)</p><p>Features analysis software in the form of the webserver.</p><h3 id="phoBehavioralBoxLabjackController-.INIConfigurationFile:">.INI Configuration File:</h3><p>The .INI configuration file is located at &quot;C:\Common\config\phoBehavioralBoxLabjackController-Config.ini&quot; by default.</p><p>It specifies several user-tweakable settings that control the operation of the program without recompiling.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col style="width: 224.0px;"/><col style="width: 873.0px;"/></colgroup><tbody><tr><th class="confluenceTh">Variable Name</th><th class="confluenceTh">Explanation</th></tr><tr><td class="confluenceTd"><code>CONTINUE_WITHOUT_LABJACKS</code></td><td class="confluenceTd">if false, it waits on at least one labjack hardware to be detected before moving forward.</td></tr><tr><td class="confluenceTd"><code>globalDaylightStartHour</code></td><td class="confluenceTd"><p>defines the hour of the day (in a 24-hour format) at which the Visible LEDS are turned on (illuminated) (simulating daylight for the mouse).</p><p>Ex: 6: The lights turn on at 6am and remain on until the subsequent globalDaylightOffHour</p></td></tr><tr><td colspan="1" class="confluenceTd"><code>globalDaylightOffHour</code></td><td colspan="1" class="confluenceTd"><p>defines the hour of the day (in a 24-hour format) at which the Visible LEDS are turned off (simulating nighttime for the mouse).</p><p>Ex: 18: The lights turn off at 6pm and remain off until the subsequent globalDaylightStartHour</p></td></tr></tbody></table></div><h4 class="auto-cursor-target" id="phoBehavioralBoxLabjackController-Filesystem">Filesystem</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Variable Name</th><th class="confluenceTh">Explanation</th></tr><tr><td class="confluenceTd"><p><code>globalOutputFileDirectory</code></p></td><td class="confluenceTd">The base directory to which new files are output.</td></tr><tr><td colspan="1" class="confluenceTd"><p><code>globalEnableOverrideDefaultHistoricalFileSearchDirectory</code></p></td><td colspan="1" class="confluenceTd">if false, uses the same value for the historical file search directory as the default output directory.</td></tr><tr><td colspan="1" class="confluenceTd"><p><code>globalHistoricalFileSearchDirectory</code></p></td><td colspan="1" class="confluenceTd">The directory which to search for historical data files. Only used if globalEnableOverrideDefaultHistoricalFileSearchDirectory is true.</td></tr></tbody></table></div><h4 class="auto-cursor-target" id="phoBehavioralBoxLabjackController-Features">Features</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col style="width: 224.0px;"/><col style="width: 873.0px;"/></colgroup><tbody><tr><th class="confluenceTh">Variable Name</th><th class="confluenceTh">Explanation</th></tr><tr><td class="confluenceTd"><p><code>LAUNCH_WEB_SERVER</code></p></td><td class="confluenceTd">if true, enables the webserver that can be accessed by opening a browser and navigating to http://127.0.0.1:8080 on the computer that it's running on.</td></tr><tr><td class="confluenceTd"><p><code>enableHistoricalDataLoading</code></p></td><td class="confluenceTd"><p>if true, enables the loading of historical data to display graphs within the webserver or output combined CSV files.</p></td></tr></tbody></table></div><p><br/></p><h4 id="phoBehavioralBoxLabjackController-TimeSeriesChart">TimeSeriesChart</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Variable Name</th><th class="confluenceTh">Explanation</th></tr><tr><td class="confluenceTd"><p><code>shouldEnableSynchronize_Y_Axis</code></p></td><td class="confluenceTd">whether all y-axes on the webserver's graph should be the same</td></tr><tr><td colspan="1" class="confluenceTd"><p><code>numDaysToDisplay</code></p></td><td colspan="1" class="confluenceTd">number of days to display in the webserver's graph</td></tr></tbody></table></div><hr/><p>Output Path:</p><p>The output path is of the form &quot;basePath/experimentName/cohortName/animalName&quot; as requested by Brendon, where each part of the path is loaded from the .INI config file.</p><p><br/></p><hr/><div class="sectionMacroWithBorder"><div class="sectionMacroRow"><h3 id="phoBehavioralBoxLabjackController-BuildingandInstallation:">Building and Installation:</h3><p>The script in the build directory &quot;C:\Common\repo\phoBehavioralBoxLabjackController\Installer\phoBehavioralBoxLabjackController.nsi&quot; is meant to be built with &quot;NSIS&quot; to produce a silent installer in the same directory as the script named &quot;Install phoBehavioralBoxLabjackController.exe&quot;.</p><p>This installer can be installed manually to the client computers, or in batch via a tool like &quot;EMCO Remote Installer&quot;.</p><p><br/></p></div></div><br/><hr class="auto-cursor-target"/></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h2 id="phoBehavioralBoxLabjackController-HistoricalDataProcessing">Historical Data Processing</h2></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><strong>BehavioralBoxHistoricalData</strong></p><p>Serves to keep track of the historical data for a specific Behavioral Box. Most specifically the record of Labjack events that have been loaded/parsed from the the .CSV output files.</p><p>`getHistoricalDataEvents()` builds up a vector of event vectors called `variableEventVectors`. This is where the &quot;Falling-edge&quot; thresholding to recognize events is done.</p><p><br/></p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<div id="expander-969135887" class="expand-container"><div id="expander-control-969135887" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">LabjackControllerWebApplication</span></div><div id="expander-content-969135887" class="expand-content"><h4 id="phoBehavioralBoxLabjackController-LabjackControllerWebApplication">LabjackControllerWebApplication</h4><p>The primary application for the webserver that inherits from WApplication</p><p><br/></p><p>LabjackControllerWebApplication(const WEnvironment&amp; env, BoxControllerWebDataServer&amp; server);</p><p><br/></p><p>int labjackControllerApplicationWebServer(int argc, char** argv, const std::shared_ptr&lt;BehavioralBoxControllersManager&gt;* managerPtr)</p></div></div><p><br/></p><p><br/></p><p><br/></p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><br/></p><div id="expander-126035899" class="expand-container"><div id="expander-control-126035899" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">LabjackControllerOuterWidget</span></div><div id="expander-content-126035899" class="expand-content"><h4 id="phoBehavioralBoxLabjackController-LabjackControllerOuterWidget"><span style="color: rgb(34,34,34);">LabjackControllerOuterWidget</span></h4><p>Outermost webpage widget</p><hr/><p><span style="color: rgb(34,34,34);">LabjackControllerOuterWidget::</span><span style="color: rgb(34,34,34);">setupHeader()</span></p><p><br/></p><hr/><p><span style="color: rgb(34,34,34);">void LabjackControllerOuterWidget::processDataServerEvent(const DataServerEvent&amp; event)</span></p><p><span style="color: rgb(34,34,34);">This is where the &quot;server-push&quot; happens. The data server posts to this event from other sessions</span></p></div></div><br/><div id="expander-977776161" class="expand-container"><div id="expander-control-977776161" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">BoxControllerWebDataServer</span></div><div id="expander-content-977776161" class="expand-content"><p><strong>BoxControllerWebDataServer</strong></p><p>Webserver singleton. Holds a shared reference to the shared singleton manager (<strong>BehavioralBoxControllersManager)</strong>.</p><hr/><p><span style="color: rgb(34,34,34);">Most Web Page specific setup seems to be done in LabjackControllerOuterWidget’s initializer<br/>Calls requestServerHistoricalData() at the end of the initializer to get the historical data.<br/>The server asynchronously responds with an event, which is detected in processDataServerEvent(…). This then calls:<br/>    this-&gt;timeSeriesChartWidget-&gt;processHistoricalDataUpdateEvent(historicalEvent);<br/>to update the time series chart widget.<br/><br/>Looking in void LabjackControllerOuterWidget::processDataServerEvent(const DataServerEvent&amp; event), it looks like the problem must lie in the generator of the “DataServerEvent::Type::HistoricalDataRefreshed” event. This is “BoxControllerWebDataServer”</span></p><p><br/></p><p><span style="color: rgb(34,34,34);">BoxControllerWebDataServer::re</span><span style="color: rgb(34,34,34);">questHistoricalData()</span><br/><span style="color: rgb(34,34,34);">        Just Calls this-&gt;manager_-&gt;serverGetAllHi</span><span style="color: rgb(34,34,34);">storicalData(…)</span><br/><span style="color: rgb(34,34,34);">                Which intern basically performs:</span><br/><span style="color: rgb(34,34,34);">                        auto updatedData = HistoricalDataLoadingEvent(thi</span><span style="color: rgb(34,34,34);">s-&gt;historicalData_);</span><br/><span style="color: rgb(34,34,34);">            completionCallback(updatedData</span><span style="color: rgb(34,34,34);">);</span><br/><br/><br/><span style="color: rgb(34,34,34);">void BehavioralBoxControllersManage</span><span style="color: rgb(34,34,34);">r::reloadHistoricalData()</span><br/><span style="color: rgb(34,34,34);">        Finds all .CSV files in the historical data directory, then loops through the active labjacks calling:</span><br/><span style="color: rgb(34,34,34);">                this-&gt;getHistoricalData(this-&gt;</span><span style="color: rgb(34,34,34);">getActiveLabjacks()[i]-&gt;getSer</span><span style="color: rgb(34,34,34);">ialNumber());</span><br/><span style="color: rgb(34,34,34);">        … blah blah blah until finally it calls:</span><br/><span style="color: rgb(34,34,34);">        BehavioralBoxHistoricalData(th</span><span style="color: rgb(34,34,34);">is-&gt;dataFilesSearchDirectory_, labjackSerialNumber, outputVector);</span><br/><span style="color: rgb(34,34,34);">        where “outputVector” is a vector of relevant LabjackDataFile objects.</span><br/><br/><span style="color: rgb(34,34,34);">BehavioralBoxHistoricalData</span></p><p><br/></p></div></div><p><br/></p><p><br/></p><div id="expander-1715802930" class="expand-container"><div id="expander-control-1715802930" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">BehavioralBoxControllersManager</span></div><div id="expander-content-1715802930" class="expand-content"><p><strong>BehavioralBoxControllersManager</strong></p><p>Main singleton. A (singleton) server class which would protect and manage a shared resource of a vector of Labjacks. Manages Labjacks, found data files, and historical data.</p><hr/><p>BehavioralBoxControllersManager::reloadHistoricalData()</p><p>Searches the dataFilesSearchDirectory_ to find .CSV files</p><hr/><pre>BehavioralBoxHistoricalData BehavioralBoxControllersManager::getHistoricalData(int labjackSerialNumber, unsigned long long startMillisecondsSinceEpoch, unsigned long long endMillisecondsSinceEpoch)</pre><p><br/></p><p><br/></p><hr/></div></div><p><br/></p><p><br/></p><div id="expander-736729834" class="expand-container"><div id="expander-control-736729834" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">HistoricalDataLoadingEvent</span></div><div id="expander-content-736729834" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-HistoricalDataLoadingEvent">HistoricalDataLoadingEvent</h3><p>Encapsulate an event produced as a result of trying to load historical data.</p></div></div><div id="expander-672600197" class="expand-container"><div id="expander-control-672600197" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">DataServerEvent</span></div><div id="expander-content-672600197" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-DataServerEvent">DataServerEvent</h3></div></div><div id="expander-1452943758" class="expand-container"><div id="expander-control-1452943758" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">BehavioralBoxHistoricalData</span></div><div id="expander-content-1452943758" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-BehavioralBoxHistoricalData">BehavioralBoxHistoricalData</h3><p>Serves to keep track of the historical data for a specific Behavioral Box. <br/>// Most specifically the record of Labjack events that have been loaded/parsed from the the .CSV output files<br/>// getHistoricalDataEvents() builds up a vector of event vectors called variableEventVectors</p></div></div><div id="expander-1436699190" class="expand-container"><div id="expander-control-1436699190" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">EventStatistics</span></div><div id="expander-content-1436699190" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-EventStatistics">EventStatistics</h3><p><br/></p></div></div><div id="expander-1381488174" class="expand-container"><div id="expander-control-1381488174" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">ParsedVariableEvent</span></div><div id="expander-content-1381488174" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-ParsedVariableEvent">ParsedVariableEvent</h3><p>ParsedVariableEvent represents an event that was parsed from a historical CSV file</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>THIS IS NOT A Wt EVENT, &quot;Event&quot; refers to a labjack event.</p></div></div><p><br/><br/></p></div></div><div id="expander-875589198" class="expand-container"><div id="expander-control-875589198" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">ConfigurationManager</span></div><div id="expander-content-875589198" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-ConfigurationManager">ConfigurationManager</h3><p>Serves to hold the program runtime configuration, which is loaded and saved to a config file. Singleton. Holds the settings such as the Labjack port config, timings, etc.</p></div></div><br class="auto-cursor-target"/><div id="expander-1586027428" class="expand-container"><div id="expander-control-1586027428" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">LabjackDataFile</span></div><div id="expander-content-1586027428" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-LabjackDataFile">LabjackDataFile</h3><p>An output datafile</p><p><br/></p></div></div><div id="expander-1213960792" class="expand-container"><div id="expander-control-1213960792" class="expand-control" aria-expanded="true"><span class="expand-icon aui-icon aui-icon-small aui-iconfont-chevron-down"></span><span class="expand-control-text">BehavioralBoxLabjack</span></div><div id="expander-content-1213960792" class="expand-content"><h3 id="phoBehavioralBoxLabjackController-BehavioralBoxLabjack">BehavioralBoxLabjack</h3><p>Main class representing a Labjack</p><p><br/></p></div></div></div>
</div>
</div>
</div>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Mar 24, 2022 11:12</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
